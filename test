-- RIFT AUTO FLY SCRIPT V2
-- Simplified: Only detects selected rifts and teleports to them
-- Version 3.0 - Optimized

local P = game:GetService("Players")
local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")
local p = P.LocalPlayer

print("========================================")
print("RIFT AUTO FLY SCRIPT V2")
print("Version: 3.0 - Simplified & Optimized")
print("========================================")

local Config = {
    HEIGHT_OFFSET = 15, -- Teleport height above rift
    SETTINGS_FILE = "rift_auto_fly_v2_settings.json",
    
    RIFTS = {
        {name = "2026-egg", displayName = "2026 Egg Rift", type = "Egg"},
        {name = "peppermint-chest", displayName = "Peppermint Chest", type = "Chest"}
    },

    -- Event egg rifts that can be detected via the "All Egg Rifts" toggle
    -- Note: Rift names in-game use dashes (e.g., "spikey-egg"), but matching handles both dashes and spaces
    EVENT_EGGS = {
        "spikey-egg",
        "magma-egg",
        "crystal-egg",
        "lunar-egg",
        "void-egg",
        "hell-egg",
        "nightmare-egg",
        "rainbow-egg",
        "festive-egg",
        "gingerbread-egg",
        "candycane-egg",
        "aurora-egg",
        "yuletide-egg",
        "northpole-egg",
        "snowman-egg",
        "showman-egg", -- in case it's spelled this way internally
        "mining-egg",
        "neon-egg"
    }
}

-- State
local scriptActive = true
local riftDetectionEnabled = false
local allEggRiftsEnabled = false
local riftSelections = {
    ["2026-egg"] = false,
    ["peppermint-chest"] = false
}

local isAtRift = false
local storedPosition = nil
local currentRift = nil
local riftStartTime = nil
local riftDuration = 0
local luckMultiplier = nil
local knownRifts = {} -- Track rifts that already existed when script started

-- Status log
local statusLog = {}
local maxLogEntries = 50

-- Utilities
local function addStatusLog(message)
    table.insert(statusLog, os.date("%H:%M:%S") .. " - " .. message)
    if #statusLog > maxLogEntries then
        table.remove(statusLog, 1)
    end
    print(message)
end

-- Format egg name with multiplier prefix if available
local function formatEggNameWithMultiplier(baseName, multiplier)
    if multiplier and multiplier > 0 then
        return tostring(multiplier) .. "x " .. baseName
    end
    return baseName
end

-- Get luck multiplier from rift (tries multiple methods)
local function getRiftBonusLuck(rift)
    -- Method 1: Direct attribute on rift
    local bonusLuck = rift:GetAttribute("BonusLuck")
    if bonusLuck then
        return bonusLuck
    end
    
    -- Method 2: Check children with "Egg" tag (as per RandomScripts.lua)
    pcall(function()
        for _, child in ipairs(rift:GetChildren()) do
            if child:HasTag("Egg") then
                local childBonusLuck = child:GetAttribute("BonusLuck")
                if childBonusLuck then
                    bonusLuck = childBonusLuck
                    break
                end
            end
        end
    end)
    
    if bonusLuck then
        return bonusLuck
    end
    
    -- Method 3: Fallback attributes
    return rift:GetAttribute("Luck") or rift:GetAttribute("Multiplier")
end

local function loadSettings()
    if not readfile or not isfile or not HttpService then return end
    
    pcall(function()
        if isfile(Config.SETTINGS_FILE) then
            local content = readfile(Config.SETTINGS_FILE)
            if content and content ~= "" then
                local decoded = HttpService:JSONDecode(content)
                if decoded then
                    if decoded.riftDetectionEnabled ~= nil then
                        riftDetectionEnabled = decoded.riftDetectionEnabled
                    end
                    if decoded.allEggRiftsEnabled ~= nil then
                        allEggRiftsEnabled = decoded.allEggRiftsEnabled
                    end
                    if decoded.riftSelections and type(decoded.riftSelections) == "table" then
                        for name, enabled in pairs(decoded.riftSelections) do
                            if riftSelections[name] ~= nil then
                                riftSelections[name] = enabled
                            end
                        end
                    end
                    addStatusLog("‚úì Settings loaded")
                end
            end
        end
    end)
end

local function saveSettings()
    if not writefile or not HttpService then return end
    
    pcall(function()
        local settings = {
            riftDetectionEnabled = riftDetectionEnabled,
            allEggRiftsEnabled = allEggRiftsEnabled,
            riftSelections = riftSelections
        }
        local encoded = HttpService:JSONEncode(settings)
        writefile(Config.SETTINGS_FILE, encoded)
    end)
end

-- Get rift position
local function getRiftPosition(rift)
    local riftPos = nil
    
    pcall(function()
        -- For chest rifts: Find Chest object
        if rift:FindFirstChild("Chest") then
            local chest = rift.Chest
            if chest:FindFirstChild("Prompt") then
                local prompt = chest.Prompt
                if prompt.Parent and prompt.Parent:IsA("BasePart") then
                    riftPos = prompt.Parent.Position
                end
            end
            if not riftPos and chest:IsA("BasePart") then
                riftPos = chest.Position
            end
        end
        
        -- For egg rifts: Use PivotPosition or PrimaryPart
        if not riftPos and rift:IsA("Model") then
            if rift.PrimaryPart then
                riftPos = rift.PrimaryPart.Position
            else
                riftPos = rift:GetPivot().Position
            end
        end
        
        -- Fallback: Direct BasePart
        if not riftPos and rift:IsA("BasePart") then
            riftPos = rift.Position
        end
    end)
    
    return riftPos
end

-- Teleport to position
local function teleportToPosition(position)
    local char = p.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then
        return false
    end
    
    local hrp = char.HumanoidRootPart
    
    -- Disable collision temporarily
    pcall(function()
        for _, part in pairs(char:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = false
            end
        end
    end)
    
    -- Teleport
    hrp.CFrame = CFrame.new(position)
    
    -- Re-enable collision after a moment
    task.wait(0.1)
    pcall(function()
        for _, part in pairs(char:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = true
            end
        end
    end)
    
    return true
end

-- Return to stored position
local function returnToStoredPosition()
    if not storedPosition then return end
    
    addStatusLog("üîô Returning to previous position...")
    
    if teleportToPosition(storedPosition) then
        addStatusLog("‚úì Returned to previous location")
        
        -- Reset state
        isAtRift = false
        currentRift = nil
        riftStartTime = nil
        storedPosition = nil
        riftDuration = 0
        luckMultiplier = nil
    end
end

-- Handle rift spawn
local function handleRiftSpawn(rift)
    if isAtRift then
        -- Try to get multiplier for the ignored rift name if it's an egg
        local ignoredRiftName = rift.Name
        pcall(function()
            if rift:GetAttribute("Type") == "Egg" then
                local multiplier = getRiftBonusLuck(rift)
                if multiplier then
                    ignoredRiftName = formatEggNameWithMultiplier(rift.Name, multiplier)
                end
            end
        end)
        addStatusLog("‚ö† Already at a rift, ignoring: " .. ignoredRiftName)
        return
    end
    
    if not riftDetectionEnabled then
        return
    end
    
    -- Check if this rift is selected
    local riftName = string.lower(rift.Name)
    local isSelected = false
    local displayName = rift.Name
    local matchedRiftInfo = nil
    local riftTypeAttr = nil
    pcall(function()
        riftTypeAttr = rift:GetAttribute("Type")
    end)
    
    -- 1) Exact specific rifts (2026 egg, peppermint chest)
    for _, riftInfo in ipairs(Config.RIFTS) do
        local searchName = string.lower(riftInfo.name)
        local searchDisplay = string.lower(riftInfo.displayName)
        
        -- Check various name patterns
        if string.find(riftName, searchName) or 
           string.find(riftName, searchDisplay) or
           string.find(searchName, riftName) or
           string.find(searchDisplay, riftName) then
            
            if riftSelections[riftInfo.name] then
                isSelected = true
                displayName = riftInfo.displayName
                matchedRiftInfo = riftInfo
            end
            break
        end
    end

    -- 2) Event egg rifts (group toggle)
    if not isSelected and allEggRiftsEnabled then
        local simplifiedName = riftName:gsub("%s+", ""):gsub("%-", "")
        for _, eggName in ipairs(Config.EVENT_EGGS) do
            local simplifiedEgg = eggName:lower():gsub("%s+", ""):gsub("%-", "")
            if string.find(simplifiedName, simplifiedEgg, 1, true) or string.find(simplifiedEgg, simplifiedName, 1, true) then
                isSelected = true
                -- Format display name nicely (replace dash with space and capitalize)
                displayName = eggName:gsub("%-", " "):gsub("^%l", string.upper)
                matchedRiftInfo = { name = eggName, displayName = eggName, type = "Egg" }
                break
            end
        end
    end
    
    if not isSelected then
        return -- Rift not selected, ignore
    end
    
    -- Ignore if we already know about this rift (existed when script started)
    if knownRifts[rift] then
        return
    end
    
    -- Get rift position
    local riftPos = getRiftPosition(rift)
    if not riftPos then
        -- Try to format error message with multiplier if it's an egg
        local errorRiftName = rift.Name
        pcall(function()
            if matchedRiftInfo and matchedRiftInfo.type == "Egg" then
                local multiplier = getRiftBonusLuck(rift)
                if multiplier then
                    errorRiftName = formatEggNameWithMultiplier(rift.Name, multiplier)
                end
            end
        end)
        addStatusLog("‚úó Could not determine position for: " .. errorRiftName)
        return
    end
    
    -- Store current position
    local char = p.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        storedPosition = char.HumanoidRootPart.Position
    else
        addStatusLog("‚úó Could not store current position")
        return
    end
    
    -- Get duration and multiplier
    pcall(function()
        local despawnAt = rift:GetAttribute("DespawnAt")
        if despawnAt then
            local serverTime = workspace:GetServerTimeNow()
            riftDuration = math.max(0, despawnAt - serverTime)
        else
            riftDuration = 600 -- Default 10 minutes
        end
        
        -- Get luck multiplier for egg rifts
        if matchedRiftInfo and matchedRiftInfo.type == "Egg" then
            luckMultiplier = getRiftBonusLuck(rift)
        end
    end)
    
    -- Format display name with multiplier prefix for egg rifts
    local displayNameWithMultiplier = displayName
    if matchedRiftInfo and matchedRiftInfo.type == "Egg" and luckMultiplier then
        displayNameWithMultiplier = formatEggNameWithMultiplier(displayName, luckMultiplier)
    end
    
    -- Display duration + 1 second in logs (but wait for actual duration)
    local displayedDuration = riftDuration + 1
    
    addStatusLog("üéØ Rift detected: " .. displayNameWithMultiplier)
    addStatusLog("   Duration: " .. math.floor(displayedDuration / 60) .. "m " .. math.floor(displayedDuration % 60) .. "s")
    
    -- Set state
    currentRift = rift
    isAtRift = true
    riftStartTime = tick()
    
    -- Teleport to rift
    local teleportPos = riftPos + Vector3.new(0, Config.HEIGHT_OFFSET, 0)
    if teleportToPosition(teleportPos) then
        addStatusLog("‚ö° Teleported to " .. displayNameWithMultiplier)
        
        -- Monitor duration (wait for actual duration, not displayed duration)
        spawn(function()
            task.wait(riftDuration)
            
            if isAtRift and currentRift == rift then
                addStatusLog("‚è∞ Rift duration expired")
                returnToStoredPosition()
            end
        end)
    else
        addStatusLog("‚úó Failed to teleport to rift")
        -- Reset state on failure
        isAtRift = false
        currentRift = nil
        storedPosition = nil
    end
end

-- Setup rift monitoring
local function setupRiftMonitoring()
    local monitoredFolders = {}
    
    local function monitorFolder(folder, folderPath)
        if monitoredFolders[folder] then return end
        
        addStatusLog("‚úì Monitoring: " .. folderPath)
        monitoredFolders[folder] = true
        
        -- Mark existing rifts as known (don't teleport to them)
        for _, rift in ipairs(folder:GetChildren()) do
            knownRifts[rift] = true
        end
        
        -- Monitor for new rifts only
        folder.ChildAdded:Connect(function(rift)
            task.wait(0.5) -- Wait for rift to fully load
            handleRiftSpawn(rift)
        end)
    end
    
    -- Try to find Rifts folder
    pcall(function()
        if workspace:FindFirstChild("Rendered") then
            local rendered = workspace.Rendered
            local riftsFolder = rendered:FindFirstChild("Rifts")
            
            if riftsFolder then
                monitorFolder(riftsFolder, "workspace.Rendered.Rifts")
            else
                rendered.ChildAdded:Connect(function(child)
                    if child.Name == "Rifts" and not monitoredFolders[child] then
                        monitorFolder(child, "workspace.Rendered.Rifts")
                    end
                end)
            end
        else
            workspace.ChildAdded:Connect(function(child)
                if child.Name == "Rendered" then
                    task.wait(1)
                    local riftsFolder = child:FindFirstChild("Rifts")
                    if riftsFolder then
                        monitorFolder(riftsFolder, "workspace.Rendered.Rifts")
                    end
                end
            end)
        end
    end)
end

-- Create GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "RiftAutoFlyGUI_V2"
screenGui.ResetOnSpawn = false
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Global
screenGui.DisplayOrder = 99
screenGui.Parent = p.PlayerGui

-- Main frame
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 320, 0, 400)
mainFrame.Position = UDim2.new(0.5, -160, 0.5, -200)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
mainFrame.BorderSizePixel = 2
mainFrame.BorderColor3 = Color3.fromRGB(50, 200, 50)
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.Parent = screenGui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 8)
corner.Parent = mainFrame

-- Title bar
local titleBar = Instance.new("Frame")
titleBar.Size = UDim2.new(1, 0, 0, 32)
titleBar.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
titleBar.BorderSizePixel = 0
titleBar.Parent = mainFrame

local titleCorner = Instance.new("UICorner")
titleCorner.CornerRadius = UDim.new(0, 6)
titleCorner.Parent = titleBar

local titleBottomFix = Instance.new("Frame")
titleBottomFix.Size = UDim2.new(1, 0, 0, 6)
titleBottomFix.Position = UDim2.new(0, 0, 1, -6)
titleBottomFix.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
titleBottomFix.BorderSizePixel = 0
titleBottomFix.Parent = titleBar

local titleText = Instance.new("TextLabel")
titleText.Size = UDim2.new(1, -16, 1, 0)
titleText.Position = UDim2.new(0, 8, 0, 0)
titleText.BackgroundTransparency = 1
titleText.Text = "üéÑ RIFT HUNTER"
titleText.TextColor3 = Color3.fromRGB(255, 255, 255)
titleText.TextSize = 14
titleText.Font = Enum.Font.GothamBold
titleText.TextXAlignment = Enum.TextXAlignment.Left
titleText.Parent = titleBar

local contentFrame = Instance.new("Frame")
contentFrame.Size = UDim2.new(1, -16, 1, -80)
contentFrame.Position = UDim2.new(0, 8, 0, 38)
contentFrame.BackgroundTransparency = 1
contentFrame.Parent = mainFrame

-- Toggle button (full width)
local toggleBtn = Instance.new("TextButton")
toggleBtn.Size = UDim2.new(1, 0, 0, 35)
toggleBtn.Position = UDim2.new(0, 0, 0, 0)
toggleBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
toggleBtn.Text = "Rift Detection: OFF"
toggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleBtn.TextSize = 13
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.BorderSizePixel = 0
toggleBtn.Parent = contentFrame

local toggleCorner = Instance.new("UICorner")
toggleCorner.CornerRadius = UDim.new(0, 4)
toggleCorner.Parent = toggleBtn

-- Rift selection buttons (side by side) + all-egg toggle
local riftBtn1 = Instance.new("TextButton")
riftBtn1.Size = UDim2.new(0.48, 0, 0, 30)
riftBtn1.Position = UDim2.new(0, 0, 0, 42)
riftBtn1.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
riftBtn1.Text = "‚òê 2026 Egg"
riftBtn1.TextColor3 = Color3.fromRGB(255, 255, 255)
riftBtn1.TextSize = 11
riftBtn1.Font = Enum.Font.GothamBold
riftBtn1.BorderSizePixel = 0
riftBtn1.Parent = contentFrame

local riftBtn1Corner = Instance.new("UICorner")
riftBtn1Corner.CornerRadius = UDim.new(0, 4)
riftBtn1Corner.Parent = riftBtn1

local riftBtn2 = Instance.new("TextButton")
riftBtn2.Size = UDim2.new(0.48, 0, 0, 30)
riftBtn2.Position = UDim2.new(0.52, 0, 0, 42)
riftBtn2.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
riftBtn2.Text = "‚òê Peppermint"
riftBtn2.TextColor3 = Color3.fromRGB(255, 255, 255)
riftBtn2.TextSize = 11
riftBtn2.Font = Enum.Font.GothamBold
riftBtn2.BorderSizePixel = 0
riftBtn2.Parent = contentFrame

local riftBtn2Corner = Instance.new("UICorner")
riftBtn2Corner.CornerRadius = UDim.new(0, 4)
riftBtn2Corner.Parent = riftBtn2

local allEggsBtn = Instance.new("TextButton")
allEggsBtn.Size = UDim2.new(1, 0, 0, 30)
allEggsBtn.Position = UDim2.new(0, 0, 0, 80)
allEggsBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
allEggsBtn.Text = "All Event Egg Rifts: OFF"
allEggsBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
allEggsBtn.TextSize = 11
allEggsBtn.Font = Enum.Font.GothamBold
allEggsBtn.BorderSizePixel = 0
allEggsBtn.Parent = contentFrame

local allEggsCorner = Instance.new("UICorner")
allEggsCorner.CornerRadius = UDim.new(0, 4)
allEggsCorner.Parent = allEggsBtn

-- Status display (scrollable)
local statusFrame = Instance.new("ScrollingFrame")
statusFrame.Size = UDim2.new(1, 0, 1, -82)
statusFrame.Position = UDim2.new(0, 0, 0, 118)
statusFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
statusFrame.BorderSizePixel = 1
statusFrame.BorderColor3 = Color3.fromRGB(50, 50, 50)
statusFrame.ScrollBarThickness = 4
statusFrame.Parent = contentFrame

local statusCorner = Instance.new("UICorner")
statusCorner.CornerRadius = UDim.new(0, 4)
statusCorner.Parent = statusFrame

local statusLabel = Instance.new("TextLabel")
statusLabel.Size = UDim2.new(1, -12, 0, 20)
statusLabel.Position = UDim2.new(0, 6, 0, 6)
statusLabel.BackgroundTransparency = 1
statusLabel.Text = "Waiting for rifts..."
statusLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
statusLabel.TextSize = 10
statusLabel.Font = Enum.Font.Gotham
statusLabel.TextXAlignment = Enum.TextXAlignment.Left
statusLabel.TextYAlignment = Enum.TextYAlignment.Top
statusLabel.TextWrapped = true
statusLabel.Parent = statusFrame

-- Update status display
local function updateStatusDisplay()
    local text = ""
    
    -- Add current status at top if at rift
    if isAtRift and currentRift then
        pcall(function()
            local despawnAt = currentRift:GetAttribute("DespawnAt")
            if despawnAt then
                local serverTime = workspace:GetServerTimeNow()
                local actualTimeRemaining = math.max(0, despawnAt - serverTime)
                -- Display time remaining + 1 second
                local displayedTimeRemaining = actualTimeRemaining + 1
                local mins = math.floor(displayedTimeRemaining / 60)
                local secs = math.floor(displayedTimeRemaining % 60)
                
                text = text .. "‚è∞ TIME REMAINING: " .. mins .. "m " .. secs .. "s\n"
                
                -- Get current rift display name with multiplier
                local currentRiftDisplayName = currentRift.Name
                if luckMultiplier then
                    -- Try to match current rift to get proper display name
                    local riftNameLower = string.lower(currentRift.Name)
                    for _, riftInfo in ipairs(Config.RIFTS) do
                        local searchName = string.lower(riftInfo.name)
                        if string.find(riftNameLower, searchName) then
                            currentRiftDisplayName = formatEggNameWithMultiplier(riftInfo.displayName, luckMultiplier)
                            break
                        end
                    end
                    -- Check event eggs too
                    if currentRiftDisplayName == currentRift.Name then
                        for _, eggName in ipairs(Config.EVENT_EGGS) do
                            local simplifiedEgg = eggName:lower():gsub("%s+", ""):gsub("%-", "")
                            local simplifiedRift = riftNameLower:gsub("%s+", ""):gsub("%-", "")
                            if string.find(simplifiedRift, simplifiedEgg, 1, true) then
                                local formattedName = eggName:gsub("%-", " "):gsub("^%l", string.upper)
                                currentRiftDisplayName = formatEggNameWithMultiplier(formattedName, luckMultiplier)
                                break
                            end
                        end
                    end
                end
                
                text = text .. "üéØ Rift: " .. currentRiftDisplayName .. "\n"
                text = text .. "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n"
                
                -- Check if actual time expired (not displayed time)
                if actualTimeRemaining <= 0 then
                    returnToStoredPosition()
                    return
                end
            end
        end)
    end
    
    -- Add log entries
    if #statusLog == 0 then
        text = text .. "Waiting for rifts..."
    else
        for i = #statusLog, 1, -1 do -- Reverse order (newest first)
            text = text .. statusLog[i] .. "\n"
        end
    end
    
    statusLabel.Text = text
    
    -- Update canvas size
    statusLabel.Size = UDim2.new(1, -12, 0, statusLabel.TextBounds.Y + 12)
    statusFrame.CanvasSize = UDim2.new(0, 0, 0, statusLabel.TextBounds.Y + 12)
    
    -- Auto-scroll to top (newest status at top)
    statusFrame.CanvasPosition = Vector2.new(0, 0)
end

-- Update status display every second
spawn(function()
    while scriptActive do
        updateStatusDisplay()
        task.wait(1)
    end
end)

-- Button handlers
toggleBtn.MouseButton1Click:Connect(function()
    if not scriptActive then return end
    
    riftDetectionEnabled = not riftDetectionEnabled
    
    if riftDetectionEnabled then
        toggleBtn.Text = "Rift Detection: ON"
        toggleBtn.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
        addStatusLog("‚úì Rift detection enabled")
    else
        toggleBtn.Text = "Rift Detection: OFF"
        toggleBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
        addStatusLog("‚úó Rift detection disabled")
    end
    
    saveSettings()
end)

riftBtn1.MouseButton1Click:Connect(function()
    if not scriptActive then return end
    
    riftSelections["2026-egg"] = not riftSelections["2026-egg"]
    
    if riftSelections["2026-egg"] then
        riftBtn1.Text = "‚úì 2026 Egg"
        riftBtn1.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
        addStatusLog("‚úì 2026 Egg Rift selected")
    else
        riftBtn1.Text = "‚òê 2026 Egg"
        riftBtn1.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
        addStatusLog("‚úó 2026 Egg Rift deselected")
    end
    
    saveSettings()
end)

riftBtn2.MouseButton1Click:Connect(function()
    if not scriptActive then return end
    
    riftSelections["peppermint-chest"] = not riftSelections["peppermint-chest"]
    
    if riftSelections["peppermint-chest"] then
        riftBtn2.Text = "‚úì Peppermint"
        riftBtn2.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
        addStatusLog("‚úì Peppermint Chest selected")
    else
        riftBtn2.Text = "‚òê Peppermint"
        riftBtn2.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
        addStatusLog("‚úó Peppermint Chest deselected")
    end
    
    saveSettings()
end)

allEggsBtn.MouseButton1Click:Connect(function()
    if not scriptActive then return end
    
    allEggRiftsEnabled = not allEggRiftsEnabled
    
    if allEggRiftsEnabled then
        allEggsBtn.Text = "All Event Egg Rifts: ON"
        allEggsBtn.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
        addStatusLog("‚úì All event egg rifts enabled")
    else
        allEggsBtn.Text = "All Event Egg Rifts: OFF"
        allEggsBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
        addStatusLog("‚úó All event egg rifts disabled")
    end
    
    saveSettings()
end)

-- Initialize
loadSettings()

-- Update button states
if riftDetectionEnabled then
    toggleBtn.Text = "Rift Detection: ON"
    toggleBtn.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
end

if riftSelections["2026-egg"] then
    riftBtn1.Text = "‚úì 2026 Egg"
    riftBtn1.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
end

if riftSelections["peppermint-chest"] then
    riftBtn2.Text = "‚úì Peppermint"
    riftBtn2.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
end

if allEggRiftsEnabled then
    allEggsBtn.Text = "All Event Egg Rifts: ON"
    allEggsBtn.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
end

addStatusLog("‚úì Script loaded and ready")
setupRiftMonitoring()

print("========================================")
print("‚úì Rift Auto Fly V2 loaded!")
print("========================================")
